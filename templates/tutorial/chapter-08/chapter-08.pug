extends ../tutorial.pug

block title
  | Chapter 8: Internationalization - F4 Framework Tutorial

block content
  .chapter-header
    .chapter-number Chapter 8
    h1 Internationalization (i18n)
    p.description Build multilingual applications with F4's Fluent-based i18n system

  .content-section
    h2 Introduction

    p Internationalization (i18n) allows your application to support multiple languages and locales. F4 uses Mozilla's Fluent format for translations, providing a powerful and flexible system for handling multilingual content.

    h3 What We'll Cover

    ul
      li Configuring locales and languages
      li Creating Fluent translation files (.ftl)
      li Using translation functions in templates
      li Locale negotiation (path, headers, session)
      li Variables and pluralization
      li Fallback locales
      li Best practices for multilingual apps

  .content-section
    h2 What Is Fluent?

    p Fluent is Mozilla's localization system designed to:

    ul
      li Keep translations natural and readable
      li Support complex grammar rules
      li Handle pluralization automatically
      li Manage variables and formatting
      li Isolate translation logic from code

    .info-box
      strong Natural Language:
      |  
      | Fluent lets translators write natural-sounding text without worrying about code syntax.

  .content-section
    h2 Configuration

    p Configure your locales in the config file:

    pre
      code.language-php.
        // config/local.php
        namespace F4;

        class Config extends AbstractConfig
        {
            public const string DEFAULT_LOCALE = 'en';

            public const array LOCALES = [
                'en' => [
                    'extensions' => ['.en'],
                    'resources' => ['locales/messages.en.ftl'],
                    'weight' => 1.0
                ],
                'fr' => [
                    'extensions' => ['.fr'],
                    'resources' => ['locales/messages.fr.ftl'],
                    'weight' => 0.9
                ],
                'es' => [
                    'extensions' => ['.es'],
                    'resources' => ['locales/messages.es.ftl'],
                    'weight' => 0.8
                ]
            ];
        }

    h3 Configuration Options

    table
      thead
        tr
          th Option
          th Description
          th Example
      tbody
        tr
          td
            code extensions
          td File extensions for this locale
          td
            code ['.en', '.en-US']
        tr
          td
            code resources
          td Path to .ftl translation files
          td
            code ['locales/messages.en.ftl']
        tr
          td
            code weight
          td Priority for locale matching
          td
            code 1.0
            |  (higher = preferred)

  .content-section
    h2 Creating Translation Files

    p Translation files use the Fluent (.ftl) format:

    h3 English (messages.en.ftl)

    pre
      code.language-yaml.
        # Simple messages
        welcome = Welcome to our application!
        goodbye = Goodbye, see you soon!

        # Messages with variables
        hello-user = Hello, { $name }!
        items-count = You have { $count } items in your cart.

        # Pluralization
        email-count = {$count ->
            [0] You have no unread emails.
            [1] You have one unread email.
           *[other] You have { $count } unread emails.
        }

        # Attributes
        login-button = Log In
            .aria-label = Log in to your account
            .title = Click to log in

        # Multiline messages
        about-us =
            We are a company dedicated to building
            amazing software products for everyone.

    h3 French (messages.fr.ftl)

    pre
      code.language-yaml.
        # Messages simples
        welcome = Bienvenue dans notre application !
        goodbye = Au revoir, à bientôt !

        # Messages avec variables
        hello-user = Bonjour, { $name } !
        items-count = Vous avez { $count } articles dans votre panier.

        # Pluralisation
        email-count = {$count ->
            [0] Vous n'avez aucun email non lu.
            [1] Vous avez un email non lu.
           *[other] Vous avez { $count } emails non lus.
        }

  .content-section
    h2 Using Translations in Templates

    p The translation function <code>$t()</code> is available in all Pug templates:

    h3 Basic Usage

    pre
      code.language-pug.
        //- Simple message
        h1= $t('welcome')

        //- Message with variables
        p= $t('hello-user', ['name' => $userName])

        //- Pluralization
        p= $t('email-count', ['count' => $emailCount])

        //- Message attributes
        button(aria-label=$t('login-button.aria-label'))
          = $t('login-button')

  .content-section
    h2 Locale Negotiation

    p F4 determines the user's locale from multiple sources:

    h3 1. Path-Based Locale

    pre
      code.language-bash.
        // URL with locale prefix
        /en/products  → English
        /fr/products  → French
        /es/products  → Spanish

    p The locale is extracted from the first segment of the path.

    h3 2. Accept-Language Header

    pre
      code.language-bash.
        // Browser sends
        Accept-Language: fr-FR,fr;q=0.9,en;q=0.8

        // F4 selects best match based on weight

    h3 3. Session Storage

    pre
      code.language-php.
        // Store user's preference
        $_SESSION['locale'] = 'fr';

    h3 Priority Order

    .demo-box
      pre.
        1. Path-based locale (/fr/page)
        2. Session locale ($_SESSION['locale'])
        3. Accept-Language header
        4. Default locale (from config)

  .content-section
    h2 Variables in Translations

    p Pass dynamic values to translations:

    h3 Simple Variables

    pre
      code.language-yaml.
        # messages.en.ftl
        greeting = Hello, { $name }! Welcome back.
        balance = Your balance is { $amount } { $currency }.

    pre
      code.language-pug.
        //- template.pug
        p= $t('greeting', ['name' => 'Alice'])
        p= $t('balance', ['amount' => 150.50, 'currency' => 'USD'])

    h3 Number Formatting

    pre
      code.language-yaml.
        # With NUMBER function
        price = The price is { NUMBER($amount, minimumFractionDigits: 2) }.
        percentage = Discount: { NUMBER($discount, style: "percent") }

  .content-section
    h2 Pluralization

    p Fluent handles pluralization elegantly:

    h3 Simple Plurals

    pre
      code.language-yaml.
        # messages.en.ftl
        photos = {$count ->
            [0] No photos
            [1] One photo
           *[other] { $count } photos
        }

    h3 Complex Plurals

    pre
      code.language-yaml.
        # Different rules for different languages
        # English
        items-added = {$count ->
            [1] One item was added to your cart.
           *[other] { $count } items were added to your cart.
        }

        # French (different rules)
        items-added = {$count ->
            [0] Aucun article n'a été ajouté.
            [1] Un article a été ajouté.
           *[other] { $count } articles ont été ajoutés.
        }

  .content-section
    h2 Language Switcher

    p Implement a language switcher in your application:

    h3 Route-Based Approach

    pre
      code.language-pug.
        //- Language switcher in template
        nav.language-switcher
          a(href='/en' + $request['path']) English
          a(href='/fr' + $request['path']) Français
          a(href='/es' + $request['path']) Español

    h3 Session-Based Approach

    pre
      code.language-php.
        // Route to change language
        Route::post('/set-locale', function($locale) {
            if (in_array($locale, ['en', 'fr', 'es'])) {
                $_SESSION['locale'] = $locale;
            }
            // Redirect back
            return $response->withRedirect($_SERVER['HTTP_REFERER']);
        });

  .content-section
    h2 Organizing Translation Files

    p For large applications, split translations by feature:

    pre
      code.language-bash.
        templates/locales/
        ├── common.en.ftl       # Shared messages
        ├── common.fr.ftl
        ├── auth.en.ftl         # Authentication
        ├── auth.fr.ftl
        ├── products.en.ftl     # Product catalog
        ├── products.fr.ftl
        └── checkout.en.ftl     # Checkout process

    p Update config to include all files:

    pre
      code.language-php.
        public const array LOCALES = [
            'en' => [
                'extensions' => ['.en'],
                'resources' => [
                    'locales/common.en.ftl',
                    'locales/auth.en.ftl',
                    'locales/products.en.ftl',
                    'locales/checkout.en.ftl'
                ]
            ]
        ];

  .content-section
    h2 Date and Time Formatting

    p Use Fluent's DATETIME function:

    pre
      code.language-yaml.
        # messages.en.ftl
        last-login = Last login: { DATETIME($date, dateStyle: "medium") }
        event-time = Event starts at { DATETIME($timestamp, timeStyle: "short") }

  .content-section
    h2 Complete Example

    h3 Configuration

    pre
      code.language-php.
        public const array LOCALES = [
            'en' => [
                'extensions' => ['.en'],
                'resources' => ['locales/app.en.ftl'],
                'weight' => 1.0
            ],
            'fr' => [
                'extensions' => ['.fr'],
                'resources' => ['locales/app.fr.ftl'],
                'weight' => 0.9
            ]
        ];

    h3 Translation Files

    pre
      code.language-yaml.
        # app.en.ftl
        app-title = My Application
        welcome = Welcome, { $name }!
        product-count = {$count ->
            [0] No products available
            [1] One product available
           *[other] { $count } products available
        }

        # app.fr.ftl
        app-title = Mon Application
        welcome = Bienvenue, { $name } !
        product-count = {$count ->
            [0] Aucun produit disponible
            [1] Un produit disponible
           *[other] { $count } produits disponibles
        }

    h3 Template Usage

    pre
      code.language-pug.
        doctype html
        html(lang=$locale['locale'])
          head
            title= $t('app-title')
          body
            h1= $t('welcome', ['name' => $user['name']])
            p= $t('product-count', ['count' => $products.length])

  .content-section
    h2 Fallback Behavior

    p When a translation is missing:

    ol
      li F4 looks in the current locale's files
      li If not found, falls back to DEFAULT_LOCALE
      li If still not found, returns the message key

    .info-box
      strong Development Tip:
      | Missing translations return the key name, making them easy to spot during development.

  .content-section
    h2 Best Practices

    ol
      li Use semantic message keys (
        code login-button
        | , not
        code msg1
        | )
      li Keep translations in separate files, not in code
      li Provide context in comments for translators
      li Test all languages during development
      li Use pluralization rules correctly for each language
      li Organize translations by feature for large apps
      li Store user's locale preference in session
      li Provide a language switcher in your UI
      li Use Fluent's built-in formatting (numbers, dates)
      li Have native speakers review translations

  .content-section
    h2 Fluent Syntax Reference

    table
      thead
        tr
          th Feature
          th Syntax
          th Example
      tbody
        tr
          td Simple message
          td
            code key = value
          td
            code welcome = Welcome!
        tr
          td Variable
          td
            code { $var }
          td
            code hello = Hi, { $name }!
        tr
          td Pluralization
          td
            code {$count -> [options]}
          td
            code [0] [1] *[other]
        tr
          td Attribute
          td
            code .attr = value
          td
            code .title = Click here
        tr
          td Number format
          td
            code NUMBER($var)
          td
            code NUMBER($price, minimumFractionDigits: 2)
        tr
          td Date format
          td
            code DATETIME($var)
          td
            code DATETIME($date, dateStyle: "long")

  .content-section
    h2 Try It Yourself

    p Practice exercises:

    ol
      li Add Spanish (es) support to your app
      li Create translations for a login form
      li Implement a user preference-based language switcher
      li Add pluralization for comment counts
      li Organize translations into multiple files
      li Format currency amounts in different locales

  .content-section
    h2 Key Takeaways

    ul
      li F4 uses Mozilla's Fluent format for i18n
      li Configure locales in config files with resources
      li Translation files use .ftl extension
      li Use
        code $t()
        |  function in templates
      li Locale negotiation: path → session → headers → default
      li Fluent handles pluralization automatically
      li Variables pass dynamic values to translations
      li Organize large apps with multiple .ftl files
      li Always provide meaningful message keys
      li Test all supported languages

  .content-section
    h2 What's Next?

    p In Chapter 9, we'll explore exception handling:

    ul
      li Global exception handlers
      li HTTP exceptions and status codes
      li Custom error pages
      li Validation error handling
      li Development vs production error display
      li Logging and debugging exceptions

    p Ready to master error handling? Click "Next" below!
